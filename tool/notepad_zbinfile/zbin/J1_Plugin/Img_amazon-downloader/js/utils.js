if(navigator.userAgent.match("Firefox")){var storageLocalSet=chrome.storage.local.set;chrome.storage.local.set=function(e,t){storageLocalSet.apply(chrome.storage.local,[e,t])}}var autoConvertWebp=1;chrome.storage.local.get("options_config",function(e){var t=e.options_config;t&&0===t.autoConvertWebp&&(autoConvertWebp=0)});var utils={param:function(e){var t=[];for(var n in e)t.push(n+"="+encodeURIComponent(e[n]));return t.join("&")},parseJSON:function(e){if("string"!=typeof e)return e;var t;try{t=jQuery.parseJSON(e)}catch(n){t=Function(e)()}return t},cleanImgUrl:function(e){return e.replace(/_\.webp$/,"")},fileOrBlobToDataURL:function(e,t){var n=new FileReader;n.readAsDataURL(e),n.onload=function(e){t(e.target.result)}},blobToImage:function(e,t){utils.fileOrBlobToDataURL(e,function(e){var n=new Image;n.onload=function(){t(n)},n.src=e})},dataURLToBlob:function(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],r=atob(t[1]),a=r.length,o=new Uint8Array(a);a--;)o[a]=r.charCodeAt(a);return new Blob([o],{type:n})},compareVersion:function(e,t){for(var n=e.split(".").map(function(e){return parseInt(e)}),r=t.split(".").map(function(e){return parseInt(e)}),a=0;a<n.length;a++)if(n[a]!=r[a])return void 0!==r[a]?n[a]-r[a]:1;return n.length<r.length?-1:0},getBlobAndContentType:function(e,t){var n=new XMLHttpRequest;n.responseType="blob",n.onload=function(){var e=n.getResponseHeader("Content-Type"),r=window.URL.createObjectURL(n.response);t({success:!0,data:{blobUrl:r,contentType:e}})},n.onerror=function(){t({success:!1,msg:"xhr error"})};try{n.open("GET",e,!0),n.send()}catch(e){t({success:!1,msg:"Invalid uri"})}},loadImageAsBlob:function(e,t){"function"!=typeof t&&(t=function(e){});var n=new XMLHttpRequest;n.responseType="blob",n.onload=function(){var r="",a="",o=n.getResponseHeader("Content-Type");if(o){a=o.split("/")[1];var c={dataUrl:r=window.URL.createObjectURL(n.response),src:e},l=new Image;l.onload=function(){var e=parseInt(this.naturalWidth),n=parseInt(this.naturalHeight);if(c.width=e,c.height=n,autoConvertWebp&&"webp"==a){var r=document.createElement("canvas");r.width=l.width,r.height=l.height,r.getContext("2d").drawImage(l,0,0);var o=c.src.split(".");c.ext||o[o.length-1].toLowerCase();c.dataUrl=r.toDataURL("image/jpeg"),a="jpg"}c.ext=c.ext||a||"",t({success:!0,item:c})},l.onerror=function(){c.width=1,c.height=1,t({success:!1,item:c})},l.src=r}else t({success:!1})},n.open("GET",e,!0),n.send()},getDomainFromUrl:function(e){var t=e.match("://(.*?)/");return t?t[1]:""},replaceVarible:function(e){var t=e.text;if(t=t.replace(/\{PAGETITLE\}/g,e.pageTitle||""),null!=e.name&&(t=t.replace(/\{NAME\}/g,e.name)),null!=e.ext&&(t=t.replace(/\{EXT\}/g,e.ext)),null!=e.link&&(t=t.replace(/\{LINK\}/g,e.link)),null!=e.index){var n=(t=t.replace(/\{NO\}/g,e.index)).match(/\{NO([\d]+)\}/);if(n){var r=n[1],a=r.length,o=e.index+parseInt(r);(""+o).length<a&&(o=("000000000000000000000000000000"+o).substr(-a)),t=t.replace(/\{NO([\d]+)\}/g,o)}}return t},checkTabDownloadableByUrl:function(e){return!e.match(/^(chrome)/)},getInfoFromBlob:function(e,t){var n=e.contentType.split("/")[1],r=new Image,a={};r.onload=function(){if(a.ext="octet-stream"==n?"":n,a.width=r.naturalWidth,a.height=r.naturalHeight,_config.autoConvertWebp&&"webp"==n){var o=utils.getJpgPngDataUrlFromWebp(r,e.bigUrl);a.jpgPngDataUrl=o.jpgPngDataUrl,a.ext=o.ext||a.ext}t({success:!0,data:a})},r.src=e.blobUrl},getJpgPngDataUrlFromWebp:function(e,t){var n=document.createElement("canvas");n.width=e.naturalWidth,n.height=e.naturalHeight,n.getContext("2d").drawImage(e,0,0);var r=t.split("."),a=r[r.length-1].toLowerCase();a.replace(/[?#].*/,"");return{jpgPngDataUrl:n.toDataURL("image/jpeg"),ext:"jpg"}},getAllBgImages:function(){var e,t=[],n=document.getElementsByTagName("*");for(n=t.slice.call(n,0,n.length);n.length;)(e=utils.deepCss(n.shift(),"background-image"))&&(e=/url\(['"]?([^")]+)/.exec(e)||[]),(e=e[1])&&!e.match(/:\/\//)&&(e=e.match(/^\/\//)?location.protocol+e:e.match(/^\/[^/]/)?location.protocol+"//"+location.host+e:location.href.replace(/[^/]+$/,e)),e&&-1==t.indexOf(e)&&(t[t.length]=e);return t},deepCss:function(e,t){if(!e||!e.style)return"";var n=t.replace(/\-([a-z])/g,function(e,t){return t.toUpperCase()});if(e.currentStyle)return e.style[n]||e.currentStyle[n]||"";var r=document.defaultView||window;return e.style[n]||r.getComputedStyle(e,"").getPropertyValue(t)||""},translateUrl:function(e){var t=[],n=[],r=/\d+-\d+/,a=e.match(/^(.*)\[(.*?)\](.*)$/);if(a){for(var o=a[1],c=a[2],l=a[3],i=c.split(","),s=0;s<i.length;s++){var u=i[s];if(u.indexOf("-")>0){var g=u.split("-")[0],p=u.split("-")[1];if(r.test(u))for(var f=parseInt(g);f<=parseInt(p);f++)n.push("00000".substr(0,g.length-(""+f).length)+f);else for(var h=g.charCodeAt(0);h<=p.charCodeAt(0);h++)n.push(String.fromCharCode(h))}else n.push(u)}for(s=0;s<n.length;s++)t.push(o+n[s]+l)}else e.match(/^https?:\/\/.*$/)&&t.push(e);return t},offset:function(e,t){for(var n="offset"+t[0].toUpperCase()+t.substring(1),r=e[n],a=e.offsetParent;null!=a;)r+=a[n],a=a.offsetParent;return r},getI18n:function(){return new Promise(function(e,t){chrome.i18n.getAcceptLanguages(t=>{t=t.map(e=>e.replace("-","_")),chrome.runtime.getPackageDirectoryEntry(function(n){n.getDirectory("_locales",{create:!1},function(n){n.createReader().readEntries(function(n){for(var r,a=n.map(function(e){return e.name}),o=0;o<t.length;o++)if(a.indexOf(t[o])>=0){r=t[o];break}fetch("/_locales/en/messages.json").then(e=>e.json()).then(t=>{r?fetch("/_locales/"+r+"/messages.json").then(e=>e.json()).then(n=>{e(Object.assign(t,n))}):e(t)})})})})})})},PrefixZero:function(e,t){return(Array(t).join(0)+e).slice(-t)}};