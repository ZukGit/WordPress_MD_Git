function addDragDownload(){var t=0;dragDownloadAdded=!0;var a,n,e,o,r,i,s,c=1;function d(t){if(2===c)r.css({bottom:"0",opacity:.9});else{var a=e,n=o;if(0===e&&0===o)return;"Top"===t.orientation?(a-=120,(n=n-240-80)<0&&(n=0),a+240>window.innerWidth&&(a=window.innerWidth-240),r.css({opacity:.8,left:a,top:n,transform:"scale(1)"})):"Bottom"===t.orientation?(a-=120,(n+=80)<0&&(n=0),a+240>window.innerWidth&&(a=window.innerWidth-240),r.css({opacity:.8,left:a,top:n,transform:"scale(1)"})):"Right"===t.orientation?(a+=80,(n-=120)<0&&(n=0),a+240>window.innerWidth&&(a=window.innerWidth-240),r.css({opacity:.8,left:a,top:n,transform:"scale(1)"})):(a=a-80-240,(n-=120)<0&&(n=0),a<0&&(a=0),r.css({opacity:.8,top:n,left:a,transform:"scale(1)"}))}}window.jQuery("body").on("mousemove",function(t){t.originalEvent.pageX,t.originalEvent.pageY,a=t.originalEvent.clientX,n=t.originalEvent.clientY}),top!=self||r||0!=$("#yuntu-drop-panel").length||0!=$("#fatkun-drop-panel").length||(i=function(t){},chrome.storage.local.get("dropPanelHtml",function(a){var n=a.dropPanelHtml;r=$(n).appendTo(document.body),navigator.language.match("^zh")&&(r.find(".fatkun-title").text("拖拽到此处"),r.find(".fatkun-desc").text("图片将完成下载")),r.on("dragleave",function(){return 2===c?r.css({opacity:.8}):r.css({opacity:.8,transform:"scale(1)"}),!1}).on("dragover",function(){return 2===c?r.css({opacity:1}):r.css({opacity:1,transform:"scale(1.05)"}),!1}).on("drop",function(a){if(location.href.match("instagram.com"))parsers.instagram(s,function(a){imageManager.imgList=[],imageManager.addImg(ImageType.IMG,a,0,0),new ParsedPItem({src:a},t,_tabInfo,function(t){parsedPItem.showIndex=parsedPItem.index,chrome.runtime.sendMessage({cmd:"DOWNLOAD_BY_DRAG",item:parsedPItem})}),t++,r.stop().css({top:"-9999999px",transform:"scale(1)",opacity:0})});else{var n=a.originalEvent.dataTransfer.getData("fatkun");a.originalEvent.dataTransfer.getData("type"),new ParsedPItem({src:n},t,_tabInfo,function(t){t.showIndex=t.index,chrome.runtime.sendMessage({cmd:"DOWNLOAD_BY_DRAG",item:t})}),t++,r.stop().css({top:"-9999999px",transform:"scale(1)",opacity:0})}return!1}),r.find("#fatkun-drop-panel-close-btn").click(function(){r.stop().css({top:"-9999999px",transform:"scale(1)",opacity:0})}),i()})),window.jQuery("body").on("mousedown","video",function(t){$(this).attr("draggable","true")}),window.jQuery("body").on("dragstart","img, a, video",function(t){var r;if(_config.dragDownload&&(s=t.target,"IMG"==t.target.tagName?r=t.target.src:"A"==t.target.tagName?(location.href.match("facebook.com")&&(r=$(t.target).attr("data-ploi")),r||(r=(r=$(t.target).find("img")[0])?r.src:"")):"VIDEO"==t.target.tagName&&(r=t.target.currentSrc),r)){var i=t.dataTransfer||t.originalEvent.dataTransfer;i.setData("fatkun",r),i.setData("type",t.target.tagName),i.setData("text/plain","fatkun"),e=t.originalEvent.clientX,o=t.originalEvent.clientY,setTimeout(function(){d(Math.abs(e-a)>Math.abs(o-n)?e<=a?{orientation:"Right"}:{orientation:"Left"}:o<=n?{orientation:"Bottom"}:{orientation:"Top"})},150)}}),window.addEventListener("dragend",function(){r.stop().css({top:"-9999999px",transform:"scale(1)",opacity:0})})}addDragDownload();