var gSites={"item.taobao.com":function(){if(top==self){var e=0;chrome.runtime.sendMessage({cmd:"SET_GROUPS",groups:["主图","视频","SKU图片","详情"]});var t=document.querySelectorAll("#J_UlThumb img"),r=document.querySelectorAll(".J_TSaleProp a"),o=document.querySelectorAll("#description img"),c=1;t.forEach(function(e){e.src.match(/tbvideo.jpg/)||g({alt:"主图-"+l(c++,2),src:e.src,group:"主图",groupIndex:0})});var a=1;r.forEach(function(e){var t=e.style.backgroundImage.match(/(\/\/.*)"/);t&&g({src:t=t=location.protocol+t[1],group:"SKU图片",groupIndex:2,alt:"SKU-"+l(a++,2)+"-"+$(e).find("span").text()})});var n=1;o.forEach(function(e){var t=e.dataset.ksLazyload||e.src;t.match("img-tmdetail.alicdn.com/tps/i3/T1BYd_XwFcXXb9RTPq-90-90.png")||t.match("spaceball.gif")||g({alt:"详情-"+l(n++,2),src:t,group:"详情",groupIndex:3})});var i,s=document.querySelector('meta[name="microscope-data"]'),u=document.querySelectorAll("script");if(s&&(userId=s.content.match(/userid=(\d+);/),userId)){userId=userId[1];for(var d=0;d<u.length;d++)if(u[d].innerText&&!i&&(i=u[d].innerText.match(/"videoId":"(\d+)"/))){i=i[1];var m="https://cloud.video.taobao.com/play/u/"+userId+"/p/1/e/6/t/1/"+i+".mp4";new VItem({src:m,group:"视频",groupIndex:1},e++,_tabInfo,function(e){chrome.runtime.sendMessage({cmd:"ADD_VIDEO",tabId:_tabInfo.id,item:e})});break}}}function l(e,t){return(Array(t).join(0)+e).slice(-t)}function g(t){new ParsedPItem(t,e++,_tabInfo,function(e){e.width>300&&chrome.runtime.sendMessage({cmd:"ADD_IMG",tabId:_tabInfo.id,item:e})})}},"detail.tmall.com":function(){if(top==self){var e=0;chrome.runtime.sendMessage({cmd:"SET_GROUPS",groups:["主图","视频","SKU图片","详情"]});var t=document.querySelectorAll("#J_UlThumb img"),r=document.querySelectorAll(".J_TSaleProp a"),o=document.querySelectorAll("#description img"),c=1;t.forEach(function(e,t){m({src:e.src,alt:"主图-"+d(c++,2),group:"主图",groupIndex:0})});var a=1;r.forEach(function(e,t){var r=e.style.backgroundImage.match(/(\/\/.*)"/);r&&m({src:r=r=location.protocol+r[1],group:"SKU图片",groupIndex:2,alt:"SKU-"+d(a++,2)+"-"+$(e).parent().attr("title")})});var n=1;o.forEach(function(e,t){var r=e.dataset.ksLazyload||e.src;r.match("img-tmdetail.alicdn.com/tps/i3/T1BYd_XwFcXXb9RTPq-90-90.png")||r.match("spaceball.gif")||m({alt:"详情-"+d(n++,2),src:r,group:"详情",groupIndex:3})});for(var i=document.querySelectorAll("script"),s=0;s<i.length;s++)if(i[s].innerText&&(imgVedioID=i[s].innerText.match(/"imgVedioID":"(\d+)"/),imgVedioID&&(imgVedioID=imgVedioID[1],userId=i[s].innerText.match(/"userId":"(\d+)"/),userId=userId?userId[1]:"",imgVedioID&&userId))){var u="https://cloud.video.taobao.com/play/u/"+userId+"/p/1/e/6/t/1/"+imgVedioID+".mp4";new VItem({src:u,group:"视频",groupIndex:1},e++,_tabInfo,function(e){chrome.runtime.sendMessage({cmd:"ADD_VIDEO",tabId:_tabInfo.id,item:e})});break}}function d(e,t){return(Array(t).join(0)+e).slice(-t)}function m(t){new ParsedPItem(t,e++,_tabInfo,function(e){e.width>300&&chrome.runtime.sendMessage({cmd:"ADD_IMG",tabId:_tabInfo.id,item:e})})}},"detail.1688.com":function(){if(top==self){var e=0;if(chrome.runtime.sendMessage({cmd:"SET_GROUPS",groups:["主图","视频","SKU图片","详情"]}),location.href.match("detail.1688.com")){var t=document.querySelectorAll("#dt-tab img"),r=document.querySelectorAll(".obj-leading img,.table-sku img"),o=document.querySelectorAll(".de-description-detail img"),c=1;t.forEach(function(e){l({src:e.dataset.lazySrc||e.src,group:"主图",groupIndex:0,alt:"主图-"+m(c++,2)})});var a=1;r.forEach(function(e){l({src:e.src,group:"SKU图片",groupIndex:2,alt:"SKU-"+m(a++,2)+"-"+e.alt})});var n=1;if(o.forEach(function(e){l({src:e.src,group:"详情",groupIndex:3,alt:"详情-"+m(n++,2)})}),0==o.length){var i=$("#desc-lazyload-container").attr("data-tfs-url");i&&(i.match("desc.alicdn.com")||Date.now(),chrome.runtime.sendMessage({cmd:"NET",settings:{url:i}},function(e){if("ok"==e.status){var t=e.data.match(/https:\/\/cbu01.alicdn.com\/img[^ ]*?\.jpg/g);t&&t.forEach(function(e){l({src:e,group:"详情",groupIndex:3,alt:"详情-"+m(n++,2)})})}}))}location.href.match("detail.1688.com/pic")&&document.querySelectorAll("#dt-bp-tab-nav li[data-img]").forEach(function(e){l({src:e.dataset.img})});var s,u=document.querySelector(".mod-detail-version2018-gallery, .mod-detail-gallery");if(u&&(s=JSON.parse(u.dataset.modConfig)).userId&&s.mainVideoId){var d="https://cloud.video.taobao.com/play/u/"+s.userId+"/p/1/e/6/t/1/"+s.mainVideoId+".mp4";new VItem({src:d,group:"视频",groupIndex:1},e++,_tabInfo,function(e){chrome.runtime.sendMessage({cmd:"ADD_VIDEO",tabId:_tabInfo.id,item:e})})}}else document.querySelectorAll("img").forEach(function(e,t){new ParsedPItem(e,t,_tabInfo,function(e){chrome.runtime.sendMessage({cmd:"ADD_IMG",tabId:_tabInfo.id,item:e})})})}function m(e,t){return(Array(t).join(0)+e).slice(-t)}function l(t){new ParsedPItem(t,e++,_tabInfo,function(e){e.width>300&&chrome.runtime.sendMessage({cmd:"ADD_IMG",tabId:_tabInfo.id,item:e})})}},amazon:function(){if(top==window){var index=0;if(top==window){var script=document.querySelector("#imageBlockVariations_feature_div>script"),imgs=[],skuImgs=[],groups=["SKU"];if(script)try{eval("var obj="+script.innerText.match(/jQuery.parseJSON\('(.*?)'\)/)[1]);var groupIndex=0,skuIndex=0;for(var key in obj.colorImages)groups.push(key),imgs=imgs.concat(obj.colorImages[key].map(function(e,t){return 0==t&&skuImgs.push({alt:`SKU-${PrefixZero(++skuIndex,2)}-${key}`,src:e.hiRes||e.large,group:"SKU",groupIndex:0}),{alt:`${key}-${PrefixZero(t+1,2)}`,src:e.hiRes||e.large,group:key,groupIndex:groupIndex++}}))}catch(e){}if(imgs.length>0){skuImgs.forEach(function(e){send(e)}),imgs.forEach(function(e){send(e)});for(var descImgs=document.querySelectorAll("#aplus img"),i=0;i<descImgs.length;i++)send({src:descImgs[i].dataset.src||descImgs[i].src,alt:`详情Detail-${i+1}`,group:"详情Detail",groupIndex:1e3});groups.push("详情Detail"),chrome.runtime.sendMessage({cmd:"SET_GROUPS",groups:groups})}else{for(var scripts=document.querySelectorAll("script"),i=0;i<scripts.length;i++){var matchrst=scripts[i].innerText.match(/var data = {[\s\S]*'colorImages'[\s\S]*?};/),colorImages=[];if(matchrst){try{eval(matchrst[0]),colorImages=data.colorImages.initial,colorImages.forEach(function(e){imgs.push({src:e.hiRes||e.large})})}catch(e){matchrst=matchrst[0].match("initial.*?(\\[.*}\\])},"),eval(`colorImages=${matchrst[1]}`),colorImages.forEach(function(e){imgs.push({src:e.hiRes||e.large})})}break}}if(imgs.length>0)imgs.forEach(function(e,t){send(e)});else{var imgs=document.querySelectorAll("#altImages img");0==imgs.length&&(imgs=document.querySelectorAll("img")),imgs.forEach(function(e){send({src:e.src})})}}}}function send(e){new ParsedPItem(e,index++,_tabInfo,function(e){chrome.runtime.sendMessage({cmd:"ADD_IMG",tabId:_tabInfo.id,item:e})})}function PrefixZero(e,t){return(Array(t).join(0)+e).slice(-t)}},"item.jd.com":function(){var e=0;function t(e,t){return(Array(t).join(0)+e).slice(-t)}var r,o,c=[];if(location.href.match("item.jd.(com|hk)")){chrome.runtime.sendMessage({cmd:"SET_GROUPS",groups:["主图","视频","SKU图片","详情"]});var a=1;document.querySelectorAll("#spec-list img").forEach(function(e){e.src.replace(/\/n\d+\//,"/imgzone/").replace(/s\d+x\d+_jfs/,"jfs").replace(/!cc_50x64.jpg$/,""),c.push({src:e.src.replace(/^(https?:)/,"https:"),group:"主图",groupIndex:0,alt:"主图-"+t(a++,2)})});var n=1;document.querySelectorAll("#choose-attrs img").forEach(function(e){c.push({src:e.src,group:"SKU图片",groupIndex:2,alt:"SKU-"+t(n++,2)})});var i=1;document.querySelectorAll("#J-detail-content img").forEach(function(e){c.push({src:e.src,group:"详情",groupIndex:3,alt:"详情-"+t(i++,2)})});var s=document.querySelector("#J-detail-content style");if(s)for(var u=new RegExp(".ssd-module-wrap (\\..+?){.*?background-image:url\\((.+?)\\)","g"),d=u.exec(s.innerText);d;)c.push({src:d[2].replace(/^(https?:)/,"https:"),group:"详情",groupIndex:3,alt:"详情-"+t(i++,2)}),d=u.exec(s.innerText);var m=document.getElementById("v-video");m&&(m=m.dataset.vu,chrome.runtime.sendMessage&&chrome.runtime.sendMessage({cmd:"NET",settings:{url:"https://c.3.cn/tencent/video_v3",data:{vid:m,_:Date.now()},dataType:"json"}},function(t){if("ok"==t.status){var r=t.data;new VItem({src:r.playUrl,group:"视频",groupIndex:1},e++,_tabInfo,function(e){chrome.runtime.sendMessage({cmd:"ADD_VIDEO",tabId:_tabInfo.id,item:e})})}}))}else document.querySelectorAll("img").forEach(function(e){c.push({src:e.src})});for(var l=0;l<c.length;l++)c[l].src.match("blank.gif")||(r=c[l],o=void 0,(o=r.src.replace(/^(https?:)/,"https:")).match("^//")&&(o=location.protocol+o),new ParsedPItem({src:o.replace("!cc_60x76.jpg",""),alt:r.alt,group:r.group,groupIndex:r.groupIndex},e++,_tabInfo,function(e){chrome.runtime.sendMessage({cmd:"ADD_IMG",tabId:_tabInfo.id,item:e})}))}};function getSiteScript(){for(var e in gSites)if(location.href.match(e))return gSites[e]}