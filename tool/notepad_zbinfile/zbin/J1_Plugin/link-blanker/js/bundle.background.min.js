/*!
 * linkblanker - Open link in new tab.
 * @version v2.5.3
 * @link https://www.aozora-create.com/service/linkblanker
 * @license MIT
 */!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=88)}({15:function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},24:function(e,t,n){"use strict";var r=window.console,o={debug:function(){},info:r.info.bind(r,"[info]:"),warn:r.warn.bind(r,"[warn]:"),error:r.error.bind(r,"[error]:")};e.exports=o},31:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(32),i=(r=a)&&r.__esModule?r:{default:r};var s={},l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,null,[{key:"getParseUrlCache",value:function(e){var t=s[e];return!!t&&t.value}},{key:"setParseUrlCache",value:function(t,n){if(Object.keys(s).length>50){var r=e.objectValues(s);r.sort(function(e,t){return e.time<t.time?-1:e.time>t.time?1:0}),r.splice(0,Math.floor(25)).forEach(function(e){delete s[e.key]})}s[t]={key:t,value:n,time:new Date}}},{key:"parseUrl",value:function(t){var n=e.getParseUrlCache(t);if(n)return n;var r=i.default.parse(t);Object.keys(r).forEach(function(e){r[e]||(r[e]="")}),r.domain=r.host;var o=r.pathname.split("/").filter(function(e){return e&&""!==e}),a="";return o.length>=2&&(a=r.protocol+"//"+r.auth+(""!==r.auth?"@":"")+r.host+"/"+o.splice(0,o.length-1).join("/")),r.directory=a,r.url=r.href,e.setParseUrlCache(t,r),r}},{key:"objectValues",value:function(e){return e?Object.keys(e).map(function(t){return e[t]}):[]}},{key:"isArray",value:function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{key:"bindAll",value:function(e,t){var n={};return Object.keys(e).forEach(function(r){n[r]=e[r].bind(t)}),n}}]),e}();t.default=l},32:function(e,t,n){"use strict";var r=n(33),o=n(35);function a(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=y,t.resolve=function(e,t){return y(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?y(e,!1,!0).resolveObject(t):t},t.format=function(e){o.isString(e)&&(e=y(e));return e instanceof a?e.format():a.prototype.format.call(e)},t.Url=a;var i=/^([a-z0-9.+-]+:)/i,s=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,u=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),c=["'"].concat(u),h=["%","/","?",";","#"].concat(c),f=["/","?","#"],d=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,b={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},v=n(36);function y(e,t,n){if(e&&o.isObject(e)&&e instanceof a)return e;var r=new a;return r.parse(e,t,n),r}a.prototype.parse=function(e,t,n){if(!o.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var a=e.indexOf("?"),s=-1!==a&&a<e.indexOf("#")?"?":"#",u=e.split(s);u[0]=u[0].replace(/\\/g,"/");var y=e=u.join(s);if(y=y.trim(),!n&&1===e.split("#").length){var k=l.exec(y);if(k)return this.path=y,this.href=y,this.pathname=k[1],k[2]?(this.search=k[2],this.query=t?v.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var w=i.exec(y);if(w){var x=(w=w[0]).toLowerCase();this.protocol=x,y=y.substr(w.length)}if(n||w||y.match(/^\/\/[^@\/]+@[^@\/]+/)){var O="//"===y.substr(0,2);!O||w&&m[w]||(y=y.substr(2),this.slashes=!0)}if(!m[w]&&(O||w&&!g[w])){for(var j,S,C=-1,T=0;T<f.length;T++){-1!==(A=y.indexOf(f[T]))&&(-1===C||A<C)&&(C=A)}-1!==(S=-1===C?y.lastIndexOf("@"):y.lastIndexOf("@",C))&&(j=y.slice(0,S),y=y.slice(S+1),this.auth=decodeURIComponent(j)),C=-1;for(T=0;T<h.length;T++){var A;-1!==(A=y.indexOf(h[T]))&&(-1===C||A<C)&&(C=A)}-1===C&&(C=y.length),this.host=y.slice(0,C),y=y.slice(C),this.parseHost(),this.hostname=this.hostname||"";var E="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!E)for(var U=this.hostname.split(/\./),I=(T=0,U.length);T<I;T++){var P=U[T];if(P&&!P.match(d)){for(var L="",R=0,N=P.length;R<N;R++)P.charCodeAt(R)>127?L+="x":L+=P[R];if(!L.match(d)){var M=U.slice(0,T),q=U.slice(T+1),D=P.match(p);D&&(M.push(D[1]),q.unshift(D[2])),q.length&&(y="/"+q.join(".")+y),this.hostname=M.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),E||(this.hostname=r.toASCII(this.hostname));var F=this.port?":"+this.port:"",_=this.hostname||"";this.host=_+F,this.href+=this.host,E&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==y[0]&&(y="/"+y))}if(!b[x])for(T=0,I=c.length;T<I;T++){var W=c[T];if(-1!==y.indexOf(W)){var $=encodeURIComponent(W);$===W&&($=escape(W)),y=y.split(W).join($)}}var B=y.indexOf("#");-1!==B&&(this.hash=y.substr(B),y=y.slice(0,B));var J=y.indexOf("?");if(-1!==J?(this.search=y.substr(J),this.query=y.substr(J+1),t&&(this.query=v.parse(this.query)),y=y.slice(0,J)):t&&(this.search="",this.query={}),y&&(this.pathname=y),g[x]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){F=this.pathname||"";var K=this.search||"";this.path=F+K}return this.href=this.format(),this},a.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",a=!1,i="";this.host?a=e+this.host:this.hostname&&(a=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(a+=":"+this.port)),this.query&&o.isObject(this.query)&&Object.keys(this.query).length&&(i=v.stringify(this.query));var s=this.search||i&&"?"+i||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||g[t])&&!1!==a?(a="//"+(a||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):a||(a=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),t+a+(n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(s=s.replace("#","%23"))+r},a.prototype.resolve=function(e){return this.resolveObject(y(e,!1,!0)).format()},a.prototype.resolveObject=function(e){if(o.isString(e)){var t=new a;t.parse(e,!1,!0),e=t}for(var n=new a,r=Object.keys(this),i=0;i<r.length;i++){var s=r[i];n[s]=this[s]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var l=Object.keys(e),u=0;u<l.length;u++){var c=l[u];"protocol"!==c&&(n[c]=e[c])}return g[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!g[e.protocol]){for(var h=Object.keys(e),f=0;f<h.length;f++){var d=h[f];n[d]=e[d]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||m[e.protocol])n.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),n.pathname=p.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var b=n.pathname||"",v=n.search||"";n.path=b+v}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var y=n.pathname&&"/"===n.pathname.charAt(0),k=e.host||e.pathname&&"/"===e.pathname.charAt(0),w=k||y||n.host&&e.pathname,x=w,O=n.pathname&&n.pathname.split("/")||[],j=(p=e.pathname&&e.pathname.split("/")||[],n.protocol&&!g[n.protocol]);if(j&&(n.hostname="",n.port=null,n.host&&(""===O[0]?O[0]=n.host:O.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),w=w&&(""===p[0]||""===O[0])),k)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,O=p;else if(p.length)O||(O=[]),O.pop(),O=O.concat(p),n.search=e.search,n.query=e.query;else if(!o.isNullOrUndefined(e.search)){if(j)n.hostname=n.host=O.shift(),(E=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=E.shift(),n.host=n.hostname=E.shift());return n.search=e.search,n.query=e.query,o.isNull(n.pathname)&&o.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!O.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var S=O.slice(-1)[0],C=(n.host||e.host||O.length>1)&&("."===S||".."===S)||""===S,T=0,A=O.length;A>=0;A--)"."===(S=O[A])?O.splice(A,1):".."===S?(O.splice(A,1),T++):T&&(O.splice(A,1),T--);if(!w&&!x)for(;T--;T)O.unshift("..");!w||""===O[0]||O[0]&&"/"===O[0].charAt(0)||O.unshift(""),C&&"/"!==O.join("/").substr(-1)&&O.push("");var E,U=""===O[0]||O[0]&&"/"===O[0].charAt(0);j&&(n.hostname=n.host=U?"":O.length?O.shift():"",(E=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=E.shift(),n.host=n.hostname=E.shift()));return(w=w||n.host&&O.length)&&!U&&O.unshift(""),O.length?n.pathname=O.join("/"):(n.pathname=null,n.path=null),o.isNull(n.pathname)&&o.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},a.prototype.parseHost=function(){var e=this.host,t=s.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},33:function(e,t,n){(function(e,r){var o;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(a){t&&t.nodeType,e&&e.nodeType;var i="object"==typeof r&&r;i.global!==i&&i.window!==i&&i.self;var s,l=2147483647,u=36,c=1,h=26,f=38,d=700,p=72,b=128,m="-",g=/^xn--/,v=/[^\x20-\x7E]/,y=/[\x2E\u3002\uFF0E\uFF61]/g,k={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},w=u-c,x=Math.floor,O=String.fromCharCode;function j(e){throw new RangeError(k[e])}function S(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function C(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),r+S((e=e.replace(y,".")).split("."),t).join(".")}function T(e){for(var t,n,r=[],o=0,a=e.length;o<a;)(t=e.charCodeAt(o++))>=55296&&t<=56319&&o<a?56320==(64512&(n=e.charCodeAt(o++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),o--):r.push(t);return r}function A(e){return S(e,function(e){var t="";return e>65535&&(t+=O((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=O(e)}).join("")}function E(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function U(e,t,n){var r=0;for(e=n?x(e/d):e>>1,e+=x(e/t);e>w*h>>1;r+=u)e=x(e/w);return x(r+(w+1)*e/(e+f))}function I(e){var t,n,r,o,a,i,s,f,d,g,v,y=[],k=e.length,w=0,O=b,S=p;for((n=e.lastIndexOf(m))<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&j("not-basic"),y.push(e.charCodeAt(r));for(o=n>0?n+1:0;o<k;){for(a=w,i=1,s=u;o>=k&&j("invalid-input"),((f=(v=e.charCodeAt(o++))-48<10?v-22:v-65<26?v-65:v-97<26?v-97:u)>=u||f>x((l-w)/i))&&j("overflow"),w+=f*i,!(f<(d=s<=S?c:s>=S+h?h:s-S));s+=u)i>x(l/(g=u-d))&&j("overflow"),i*=g;S=U(w-a,t=y.length+1,0==a),x(w/t)>l-O&&j("overflow"),O+=x(w/t),w%=t,y.splice(w++,0,O)}return A(y)}function P(e){var t,n,r,o,a,i,s,f,d,g,v,y,k,w,S,C=[];for(y=(e=T(e)).length,t=b,n=0,a=p,i=0;i<y;++i)(v=e[i])<128&&C.push(O(v));for(r=o=C.length,o&&C.push(m);r<y;){for(s=l,i=0;i<y;++i)(v=e[i])>=t&&v<s&&(s=v);for(s-t>x((l-n)/(k=r+1))&&j("overflow"),n+=(s-t)*k,t=s,i=0;i<y;++i)if((v=e[i])<t&&++n>l&&j("overflow"),v==t){for(f=n,d=u;!(f<(g=d<=a?c:d>=a+h?h:d-a));d+=u)S=f-g,w=u-g,C.push(O(E(g+S%w,0))),f=x(S/w);C.push(O(E(f,0))),a=U(n,k,r==o),n=0,++r}++n,++t}return C.join("")}s={version:"1.4.1",ucs2:{decode:T,encode:A},decode:I,encode:P,toASCII:function(e){return C(e,function(e){return v.test(e)?"xn--"+P(e):e})},toUnicode:function(e){return C(e,function(e){return g.test(e)?I(e.slice(4).toLowerCase()):e})}},void 0===(o=function(){return s}.call(t,n,t,e))||(e.exports=o)}()}).call(this,n(34)(e),n(15))},34:function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},35:function(e,t,n){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},36:function(e,t,n){"use strict";t.decode=t.parse=n(37),t.encode=t.stringify=n(38)},37:function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,n,a){t=t||"&",n=n||"=";var i={};if("string"!=typeof e||0===e.length)return i;var s=/\+/g;e=e.split(t);var l=1e3;a&&"number"==typeof a.maxKeys&&(l=a.maxKeys);var u=e.length;l>0&&u>l&&(u=l);for(var c=0;c<u;++c){var h,f,d,p,b=e[c].replace(s,"%20"),m=b.indexOf(n);m>=0?(h=b.substr(0,m),f=b.substr(m+1)):(h=b,f=""),d=decodeURIComponent(h),p=decodeURIComponent(f),r(i,d)?o(i[d])?i[d].push(p):i[d]=[i[d],p]:i[d]=p}return i};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},38:function(e,t,n){"use strict";var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,n,s){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?a(i(e),function(i){var s=encodeURIComponent(r(i))+n;return o(e[i])?a(e[i],function(e){return s+encodeURIComponent(r(e))}).join(t):s+encodeURIComponent(r(e[i]))}).join(t):s?encodeURIComponent(r(s))+n+encodeURIComponent(r(e)):""};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function a(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var i=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},88:function(e,t,n){"use strict";var r,o=n(89),a=(r=o)&&r.__esModule?r:{default:r};window.LinkBlanker=new a.default(chrome)},89:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=l(n(24)),s=l(n(31));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.chrome=t,this.manifest=t.runtime.getManifest(),this.tabLog={},this.receiveMessages={},this.currentWindowId=-1,this.init()}return a(e,[{key:"getData",value:function(){return Promise.resolve({"disabled-directory":JSON.parse(localStorage["disabled-directory"]||"[]"),"disabled-domain":JSON.parse(localStorage["disabled-domain"]||"[]"),"disabled-on":JSON.parse(localStorage["disabled-on"]||"0"),"disabled-page":JSON.parse(localStorage["disabled-page"]||"[]"),"disabled-same-domain":Number(localStorage["disabled-same-domain"]||"0"),"enabled-background-open":Number(localStorage["enabled-background-open"]||"0"),"enabled-extension":Number(localStorage["enabled-extension"]||"1"),"enabled-left-click":Number(localStorage["enabled-left-click"]||"1"),"enabled-middle-click":Number(localStorage["enabled-middle-click"]||"0"),"enabled-multiclick-close":Number(localStorage["enabled-multiclick-close"]||"0"),"enabled-right-click":Number(localStorage["enabled-right-click"]||"0"),"no-close-fixed-tab":Number(localStorage["no-close-fixed-tab"]||"1"),"shortcut-key-toggle-enabled":localStorage["shortcut-key-toggle-enabled"]||"","visible-link-state":Number(localStorage["visible-link-state"]||"0")})}},{key:"setData",value:function(e,t){var n=this,a={};return"object"===(void 0===e?"undefined":o(e))?a=e:a[e]=t,Promise.all([this.getData(),this.getCurrentTabUrlData()]).then(function(e){var t=r(e,2),o=t[0],i=t[1];return Object.keys(a).forEach(function(e){var t=a[e];switch(e){case"disabled-domain":case"disabled-directory":case"disabled-page":var r=n.urlDataValueFromKey(e,i);if(r&&""!==r&&null!==r){var s=o[e].indexOf(r);t?-1===s&&o[e].push(r):s>-1&&o[e].splice(s,1)}o[e]=o[e].filter(function(e){return e&&""!==e&&null!==e}),localStorage[e]=JSON.stringify(o[e]);break;case"shortcut-key-toggle-enabled":localStorage[e]=t;break;case"enabled-extension":case"enabled-background-open":case"enabled-multiclick-close":case"enabled-left-click":case"enabled-middle-click":case"enabled-right-click":case"disabled-same-domain":case"disabled-on":case"visible-link-state":case"no-close-fixed-tab":localStorage[e]=t?1:0}}),n.updateAllTabStatus().then(function(){return n.getData()})})}},{key:"getAllTabs",value:function(){var e=this;return this.getAllWindow().then(function(e){return e.reduce(function(e,t){return t.tabs?e.concat(t.tabs):e},[])}).then(function(t){return Promise.all(t.map(function(t){return new Promise(function(n){e.chrome.tabs.get(t.id,function(r){var o=e.getRuntimeError();o?reject(o):r?n(r):reject(new Error("Tab is none. ["+t.id+"]"))})}).catch(function(e){return i.default.warn(e),null})}))}).then(function(e){return e.filter(function(e){return null!==e})})}},{key:"init",value:function(){var e=this;this.dataMigration(),this.chrome.tabs.onUpdated.addListener(function(t,n,r){e.updateTabStatus(r)}),this.chrome.tabs.onRemoved.addListener(function(t){e.deleteTabLogIfExist(t)}),this.chrome.windows.onFocusChanged.addListener(function(t){e.currentWindowId=t}),this.receiveMessages=s.default.bindAll({removeTabs:this.onRemoveTabs,undoRemoveTabs:this.onUndoRemoveTabs,openTab:this.onOpenTab,toggleEnabled:this.onToggleEnabled},this),this.chrome.extension.onConnect.addListener(function(t){t.onMessage.addListener(e.receiveMessages[t.name])}),this.updateAllTabStatus()}},{key:"dataMigration",value:function(){if("disabled-extension"in localStorage){var e=Number(localStorage["disabled-extension"]||"0");localStorage["enabled-extension"]=0===e?1:0,delete localStorage["disabled-extension"]}}},{key:"getAllWindow",value:function(){var e=this;return new Promise(function(t,n){e.chrome.windows.getAll({populate:!0,windowTypes:["normal"]},function(r){var o=e.getRuntimeError();o?n(o):t(r)})})}},{key:"getCurrentWindow",value:function(){var e=this;return new Promise(function(t,n){e.currentWindowId>-1?e.chrome.windows.get(e.currentWindowId,{populate:!0,windowTypes:["normal"]},function(r){var o=e.getRuntimeError();o?n(o):t(r)}):e.chrome.windows.getCurrent({populate:!0,windowTypes:["normal"]},function(r){var o=e.getRuntimeError();o?n(o):r?(e.currentWindowId=r.id,t(r)):n(new Error("Current window is none."))})})}},{key:"getCurrentTab",value:function(){var e=this;return this.getCurrentWindow().then(function(t){return new Promise(function(n,r){e.chrome.tabs.query({windowId:t.id,active:!0},function(t){var o=e.getRuntimeError();o?r(o):!t||t.length<=0?r(new Error("Current tab is none.")):n(t[0])})})})}},{key:"getCurrentTabUrlData",value:function(){return this.getCurrentTab().then(function(e){return s.default.parseUrl(e.url)})}},{key:"updateTabStatus",value:function(e){var t=this;return Promise.all([this.isEnableFromUrl(e.url),this.getData()]).then(function(n){var o=r(n,2),a=o[0],i=o[1];return new Promise(function(n,r){t.chrome.tabs.get(e.id,function(e){t.chrome.tabs.sendMessage(e.id,{name:"updateTabStatus",parsed:s.default.parseUrl(e.url),enabled:a,isBackground:i["enabled-background-open"],multiClickClose:1===i["enabled-extension"]&&1==i["enabled-multiclick-close"]?1:0,shortcutKeyToggleEnabled:i["shortcut-key-toggle-enabled"],disabledSameDomain:i["disabled-same-domain"],isVisibleLinkState:1===i["enabled-extension"]&&1==i["visible-link-state"]?1:0,isLeftClick:1===i["enabled-extension"]&&1==i["enabled-left-click"]?1:0,isMiddleClick:1===i["enabled-extension"]&&1==i["enabled-middle-click"]?1:0,isRightClick:1===i["enabled-extension"]&&1==i["enabled-right-click"]?1:0}),t.chrome.browserAction.setBadgeBackgroundColor({color:a?[48,201,221,128]:[0,0,0,64],tabId:e.id}),t.chrome.browserAction.setBadgeText({text:a?" ON ":"OFF",tabId:e.id}),t.chrome.browserAction.setIcon({path:"img/icon32"+(a?"":"-disabled")+".png",tabId:e.id}),n()})})})}},{key:"updateAllTabStatus",value:function(){var e=this;return this.getAllTabs().then(function(t){return Promise.all(t.map(function(t){return e.updateTabStatus(t)}))})}},{key:"isEnableFromUrlData",value:function(e){var t=this;return this.getData().then(function(n){return t.isExtensionWorkFromUrl(e.url).then(function(e){return[n,e]})}).then(function(t){var n=r(t,2),o=n[0];if(0===n[1])return 0;var a=1===o["enabled-extension"]&&0===o["disabled-on"]&&-1===o["disabled-domain"].indexOf(e.domain)&&-1===o["disabled-page"].indexOf(e.url);if(a)for(var i=0;i<o["disabled-directory"].length;i++)if(e.url.match(new RegExp("^"+o["disabled-directory"][i]+".*$"))){a=!1;break}return a?1:0})}},{key:"isEnableFromUrl",value:function(e){return this.isEnableFromUrlData(s.default.parseUrl(e))}},{key:"isEnable",value:function(){var e=this;return this.getCurrentTabUrlData().then(function(t){return e.isEnableFromUrlData(t)})}},{key:"isExtensionWork",value:function(){var e=this;return this.getCurrentTabUrlData().then(function(t){return e.isExtensionWorkFromUrl(t.url)})}},{key:"isExtensionWorkFromUrl",value:function(e){var t=e.match(/^chrome:\/\/(.*)$/)||e.match(/^https:\/\/chrome\.google\.com\/webstore(.*)$/);return Promise.resolve(t?0:1)}},{key:"getTabLog",value:function(e,t){return this.tabLog[e]&&this.tabLog[e][t]?Promise.resolve(this.tabLog[e][t]):Promise.reject(new Error("Tab log is none. [tabId: "+e+", key: "+t+"]"))}},{key:"setTabLog",value:function(e,t,n){return this.tabLog[e]||(this.tabLog[e]={}),this.tabLog[e][t]=n,Promise.resolve({tabId:e,key:t,value:n})}},{key:"deleteTabLogIfExist",value:function(e){return this.tabLog[e]&&delete this.tabLog[e],Promise.resolve(e)}},{key:"getRuntimeError",value:function(){return this.chrome.runtime.lastError}},{key:"urlDataValueFromKey",value:function(e,t){return"disabled-domain"===e?t.domain:"disabled-directory"===e?t.directory:t.url}},{key:"onRemoveTabs",value:function(e){var t=this;Promise.all([this.getData(),this.getCurrentWindow(),this.getCurrentTab()]).then(function(n){var o=r(n,3),a=o[0],i=o[1],s=o[2];i.tabs.sort(function(t,n){return t.index<n.index?"right"===e.align?-1:1:t.index>n.index?"right"===e.align?1:-1:0});for(var l=[],u=-1,c=0;c<i.tabs.length;c++)i.tabs[c].active?u=i.tabs[c].id:1===a["no-close-fixed-tab"]&&i.tabs[c].pinned||u>-1&&l.push(i.tabs[c]);l.length>0&&(t.setTabLog(s.id,"remove",{align:e.align,tabs:l}),t.chrome.tabs.remove(l.map(function(e){return e.id})),e.name="norifyRemoveTabs",e.removeTabsLength=l.length,t.chrome.tabs.sendMessage(u,e))}).catch(function(e){return i.default.error(e)})}},{key:"onUndoRemoveTabs",value:function(){var e=this;this.getCurrentTab().then(function(t){return e.getTabLog(t.id,"remove").then(function(e){return[t,e]})}).then(function(t){var n=r(t,2),o=n[0],a=n[1];return e.deleteTabLogIfExist(o.id).then(function(){return[o,a]})}).then(function(t){var n=r(t,2),o=n[0],a=n[1];a.tabs.map(function(t,n){e.chrome.tabs.create({url:t.url,pinned:t.pinned,selected:!1,index:"right"===a.align?o.index+1+n:o.index})})}).catch(function(e){return i.default.error(e)})}},{key:"onOpenTab",value:function(e){var t=this;e&&this.getCurrentTab().then(function(n){e.index=n.index+1,t.chrome.tabs.create(e)}).catch(function(e){return i.default.error(e)})}},{key:"onToggleEnabled",value:function(){var e=this;this.getData().then(function(t){return e.setData("enabled-extension",0===t["enabled-extension"]?1:0)}).catch(function(e){return i.default.error(e)})}}]),e}();t.default=u}});